// $Id: ChangeLog,v 1.59 2005/11/28 07:53:37 kewlio Exp $ //

2005-11-28	Dan-m00 <daniel@undernet.org>
		* mod.cservice/cservice.cc: definately time to bump the version
			number (up to 1.4, no patchlevel)

2005-11-28	Dan-m00 <daniel@undernet.org>
		* doc/cservice.sql: define (in a comment) the flag for the new
			"no adduser" flag.  (note: no schema change)

		* mod.cservice/sqlUser.cc:
		* mod.cservice/sqlUser.h: define new flag (as above)

		* mod.cservice/SETCommand.cc: add toggle for the above flag.

		* mod.cservice/ADDUSERCommand.cc: check the user's flag before
			adding them to a channel.

		* mod.cservice/responses.h: add response codes for the above.

		* doc/language_table.sql: add english output for response codes.

		* doc/cservice.help.sql: add help topics for SET NOADDUSER.

2005-11-28	Dan-m00 <daniel@undernet.org>
		* mod.cservice/cservice.cc: make IP restriction check work with
			IP masks as well as host masks.

2005-11-28	Dan-m00 <daniel@undernet.org>
		* include/iClient.h: Add IP restriction timestamp so that we
			can track when users have passed IP restriction checks.

		* src/server.cc:
		* libircu/msg_N.cc: Initialise IP restriction timestamp when a
			new client is introduced.

		* mod.cservice/cservice.h:
		* mod.cservice/cservice.cc: Add new function checkIPR() to
			check IP restrictions.  Also, check IPR for all "*"
			accounts upon command use (except 'LOGIN')

		* mod.cservice/LOGINCommand.cc: Add call to checkIPR() to check
			against IP restrictions for "*" accounts during login.

2005-11-27	Dan-m00 <daniel@undernet.org>
		* mod.cservice/SCANUNAMECommand.cc:
		* mod.cservice/CHANINFOCommand.cc: remove IPs from output if
			target user(s) have admin access

2005-11-25	Dan-m00 <daniel@undernet.org>
		* mod.cservice/cservice.cc: Fix coredump when the DB saved pass
			was an invalid MD5 hash.

2005-11-17	Reed Loden <reed@reedloden.com>
		* mod.cservice/NEWPASSCommand.cc: Due to the 64-bit
		changes of the md5 hashing code, we now need to
		#include <inttypes.h> in order to compile NEWPASS.

2005-11-17	Dan-m00 <daniel@undernet.org>
		* src/server.cc: update JoinChannel() function to handle channel
			keys that change when X has a channel key stored.
			X will now restore the saved channel key and gnuworld's
			internal database will not be out of sync.

2005-11-17	Dan-m00 <daniel@undernet.org>
		* src/client.cc: update clearmode function to allow a manual
			clearmode (i.e. using "M" instead of "CM") for non-opers.

		* mod.cservice/CLEARMODECommand.cc: set "clearmode as server"
			flag to "no" to force the bot to use a manual mode.

2005-11-17	Dan-m00 <daniel@undernet.org>
		* mod.cservice/sqlUser.h:
		* mod.cservice/sqlUser.cc: add F_ALUMNI flag (0x80)

		* mod.cservice/cservice.h: update getAdminAccessLevel() to
			accept a boolean "verify" (used to disable the alumni
			check explicitly in the 'verify' command)

		* mod.cservice/cservice.cc: implement the above check.

		* mod.cservice/VERIFYCommand.cc: implement the above check.

2005-11-16	Dan-m00 <daniel@undernet.org>
		* libgnuworld/md5hash.h:
		* libgnuworld/md5hash.cc: include inttypes.h and convert md5
			functions to 64bit safe.  GNUworld now compiles and
			runs on 64bit operating systems.

			Tested on FreeBSD/amd64 6.0-STABLE/gcc3

2005-11-15	Dan-m00 <daniel@undernet.org>
		* include/gnuworld_config.h: update defines and comment to the
			new filename.

2005-11-14	Dan-m00 <daniel@undernet.org>
		* mod.cservice/BANCommand.cc: fix a bug when banning a hostmask.
			when banning a hostmask, set 1 ban on the original mask,
			not 1 ban per nick.

2005-11-14	Dan-m00 <daniel@undernet.org>
		* bin/server_command_map.in: handle DE (destruct) protocol as
			noop command - may be used later, but for now not needed.

2005-11-14	Dan-m00 <daniel@undernet.org>
		* mod.cservice/cservice.cc: (validUserMask) change maximum nick
			length allowed from 9 to 15 characters in-line with
			current undernet policies.

2005-11-14	Dan-m00 <daniel@undernet.org> / Isomer
		* mod.cservice/BANCommand.cc: fix some (possibly?) GCC compiler
			optimisation bugs that caused an infinite loop somehow!

		* src/iClient.cc: make things compile when both ASUKA and SRVX
			are not defined.

2005-11-13	LordLuke
		* mod.cservice/cservice.cc: update logging from flat file to SQL
			for admin log.

		* doc/cservice.sql: add adminlog table at the bottom of the file
			for the above.

2005-10-07	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol.cc: add extra memory/stats output into
			'status' command (show rate-limit entries)

			Fixed memory leak within rate limiting and clone warnings.

2005-10-05	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol.cc: rollback previous memory leak fix

2005-10-04	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/HELPCommand.cc: fix HELP command to work the way it
			was intended (to support subcommands properly)

2005-10-04	Dan-m00 <daniel@undernet.org>
		* doc/ccontrol.help.sql: completely updated help files for ccontrol

2005-10-04	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol.cc: fix a possible memory leak in the
			handling of queued glines.

		* libgnuworld/match.cc: fix CIDR matching incorrectly broken in
			an earlier commit.

		* src/Network.cc: optimise user@host matching code (used for glines
			and various other core tasks)

2005-10-04	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/USERINFOCommand.cc: add "-cl" option to userinfo
			to show Command List available to the user.

		* mod.ccontrol/ccontrol.cc: update syntax for userinfo command

2005-10-04	Dan-m00 <daniel@undernet.org>
		* aclocal.m4:
		* mod.ccontrol/Makefile.am:
		* mod.ccontrol/Makefile.in: update Makefiles for new file

		* mod.ccontrol/CHANGLINECommand.cc: new channel gline command

		* mod.ccontrol/CommandsDec.h: register new changline command

		* mod.ccontrol/commLevels.h: add a new level for changline command

		* mod.ccontrol/ccontrol.cc: bump version number and add new changline
			command

		* mod.ccontrol/GLINECommand.cc: no longer handle channel glines.

2005-10-03	Dan-m00 <daniel@undernet.org>
		* libgnuworld/ConnectionManager.cc:
		* src/Channel.cc:
		* src/Network.cc:
		* src/server.cc: make modifications to accommodate FreeBSD/gcc3
			compilation and running (it seems FreeBSD handles c++ STL
			differently for some reason)

			GNUWorld now works on FreeBSD5+/gcc3

2005-10-03	Dan-m00 <daniel@undernet.org>
		* doc/cservice.config.sql: add BAN_CHECK_ON_BURST tunable variable
			to check users against bans during burst.

		* mod.cservice/cservice.cc: use the above variable.

2005-10-03	Dan-m00 <daniel@undernet.org>
		* mod.cservice/BANCommand.cc: BAN command now matches IPs as well as
			hosts.

		* mod.cservice/cservice.cc: match IPs as well as hosts when a client
			joins a channel.
			Also check userlist against internal banlist on channel burst.

2005-10-02	Dan-m00 <daniel@undernet.org>
		* libgnuworld/match.cc: fix CIDR handling.  Only match CIDR if the
			text before the '/' is an IP address.

		* mod.ccontrol/ccontrol.cc: apply the same logic to gline check

2005-10-01	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol.cc: increase size of numeric column to 4 in
			'LIST servers' command.  Fix fake servers to align in output.

2005-10-01	Dan-m00 <daniel@undernet.org>
		* mod.cservice/BANCommand.cc:
		* mod.cservice/cservice.cc: when a user sets a hidden host ban, match
			users that are logged in, but not hidden against it.
			e.g. *!*@test.users.undernet.org will match a regular user that
				is authed under 'test', but not set mode +x

2005-10-01	Dan-m00 <daniel@undernet.org>
		* libgnuworld/EConfig.cc: Add an extra warning when a "key=value" pair
			contains no value as this is a common user error.  Suggest that
			they use "key=''" to specify an empty value (such as SQL pass)

2005-09-30	Dan-m00 <daniel@undernet.org>
		* libgnuworld/ConnectionManager.cc: remove redundant and pointless cast.

2005-09-30	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol.h: add structures for virtual clones rate limiting

		* mod.ccontrol/ccontrol.cc: add virtual clones rate limiting
			alter the output format of CIDR-based ident clones warnings

2005-09-30	Dan-m00 <daniel@undernet.org>
		* src/server.cc: swap function that handles 'regular' channel modes.

		* mod.ccontrol/LISTCommand.cc: fix compiler warning.

		* mod.ccontrol/ccontrol.h: add structures for ident clones warnings

		* mod.ccontrol/ccontrol.cc: add 'CIDR-based ident clones' warnings

		* mod.ccontrol/CONFIGCommand.cc: add config for the above feature (-IClones)

2005-09-30	Dan-m00 <daniel@undernet.org>
		* mod.cservice/cservice.cc: bumped version number up.
			Made GNUworld(cserver module) compatible with gcc4
			Tested with gcc4.0.2 / FreeBSD 7.0-CURRENT

2005-09-29	Dan-m00 <daniel@undernet.org>
		* mod.cservice/CLEARMODECommand.cc: add "D" to the modes cleared.
			Don't clear oplevel modes as they should never be touched by cservice.

		* doc/cservice.config.sql: remove old, unused variables
			Add new 'MAX_BANS' config entry for BAN command.

		* doc/README.cservice: add references to cservice.config.sql and
			greeting.sql as these are not already listed.

		* mod.cservice/BANCommand.cc: add a maximum limit of bans per channel.
			This is set via the config command (variables SQL table)

		* libircu/msg_B.cc: fixed parsing of oplevels in burst (ignore them)

2005-09-29	Dan-m00 <daniel@undernet.org>
		* include/Channel.h:
		* include/client.h:
		* include/events.h:
		* include/server.h:
		* libircu/msg_B.cc:
		* libircu/msg_M.cc:
		* src/Channel.cc:
		* src/Network.cc:
		* src/client.cc:
		* src/server.cc:
		* src/server_events.cc:
			Add basic support for oplevels from u2.10.12
			Thanks to reed for the initial diff

		* mod.cservice/cservice.cc: fix a ban bug - thanks to reed for this diff

2005-09-29	Dan-m00 <daniel@undernet.org>
		* configure.ac: config.h hasnt existed in... years! update to gnuworld_config.h

		* configure: rebuilt configure with autoconf

2005-09-28	Dan-m00 <daniel@undernet.org>
		* .cvsignore: ignore configure.lineno, tidy up

		* libltdl/.cvsignore: ignore configure.lineno

		* mod.cservice/ACCESSCommand.cc:
		* mod.cservice/CHANINFOCommand.cc:
		* mod.cservice/CLEARMODECommand.cc:
		* mod.cservice/LBANLISTCommand.cc:
		* mod.cservice/SEARCHCommand.cc:
		* mod.cservice/SETCommand.cc:
		* mod.cservice/cservice.cc:
		* mod.cservice/cservice.h:
		* mod.cservice/levels.h:
		* mod.cservice/sqlChannel.cc:
			Merge changes from private repositories into mainstream CVS
			Most notable is extra IP-based flood protection and a few level changes.

			This is in preparation for u2.10.12 updates to the code and bugfixes.

2005-08-24	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/JUPECommand.cc: remove the 'currently connected' check when
			juping a server as ircu will automatically /squit it for you.

2005-08-24	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/WHOISCommand.cc: split channel output to multiple lines if the
			user is in multiple long channels.
			Thanks to coekie + compy for spotting this bug.

2005-08-16	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/EXCEPTIONCommand.cc: generate a warning if an unknown subcommand
			is used to 'exceptions' (e.g. 'exceptions delete')

2005-08-16	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/SGLINECommand.cc: disallow '/' character in sglines (bugfix) as
			ircu handles these differently to ccontrol.

2005-06-25	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/LISTCommand.cc: added channel usercount to 'list channels' output

2005-06-24	Dan-m00 <daniel@undernet.org>
		* include/Channel.h: added support for new u2.10.12 "+D" channel mode.

		* libircu/msg_B.cc: as above.

		* libircu/msg_CM.cc: as above.

		* libircu/msg_M.cc: as above.

		* src/Channel.cc: as above.

		* src/client.cc: as above.

		* src/server.cc: as above.

		* include/Network.h: added function prototype for GetChannelsWithModes()

		* src/Network.cc: added function for GetChannelsWithModes()

		* mod.ccontrol/LISTCommand.cc: updated 'list' command to include the following:
			'list channels modes X'

2005-06-24	Dan-m00 <daniel@undernet.org>
		* include/Network.h: added function prototype for the following functions:
			GetChannelsWithTopic()
			GetChannelsWithTopicBy()

		* src/Network.cc: added functions (above)

		* mod.ccontrol/LISTCommand.cc: updated 'list' command to include the following:
			'list channels topic X'
			'list channels topicby nick!user@host'

		* mod.ccontrol/ccontrol.cc: updated usage syntax for 'list' command to include 'channels'

2005-06-24	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/LISTCommand.cc: fixed a bug which causes an assertion failure if
			a channel key is not given in 'list channels key...' command.

2005-06-23	Dan-m00 <daniel@undernet.org>
		* include/Network.h: added function prototype for GetChannelsWithKey() function

		* src/Network.cc: added function GetChannelsWithKey()

		* mod.ccontrol/LISTCommand.cc: updated 'list' command to include 'list channels key X'
			to return a list of channels matching a key.

2005-06-20	Dan-m00 <daniel@undernet.org>
		* include/Channel.h: added new variables to channel structure;
			topic_ts (timestamp topic was set)
			topic_whoset (who set the topic in "nick!user@host [ip]" format
			added get/setTopicTS(), get/setTopicWhoSet() functions

		* libircu/msg_T.cc: update topic timestamp + who set when we receive topics
			also fixed a bug that stopped topic_track working in u2.10.12

		* src/iClient.cc: when new channel is created (and topic_track enabled), initialise
			new variables to 0/blank.

		* mod.ccontrol/CHANINFOCommand.cc: add new topic ts+set info into 'chaninfo' command

2005-06-19	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/WHOISCommand.cc: added connection time to 'whois' command in
			human readable format - also listed unix ts for those that like to convert.

		* mod.ccontrol/OPCommand.cc: check that at least 1 user to op is in the
			channel to op!  If not, tell the user.

		* src/client.cc: don't require ccontrol user to join channel in order to invite.

		* mod.ccontrol/INVITECommand.cc: check that the channel exists before issuing an invite.

		* mod.ccontrol/DEOPCommand.cc: check that at least 1 user to deop is in the
			channel!  If not, tell the user.

		* mod.ccontrol/SCANCommand.cc: add extra option "-i" to SCAN command.
			- shows an ident report (number of unique idents etc to assist clone hunters)

		* mod.ccontrol/ccontrol.cc: update syntax in 'SCAN' command.

2005-06-19	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol_generic.h: added Duration() function similar to Ago()

		* mod.ccontrol/ccontrol_generic.cc: added Duration() function similar to Ago()

		* mod.ccontrol/ccontrol.cc: changed output of 'list' commands to be more readable
			- made output of 'list glines' more human readable
			- made output of 'list servers' more human readable

		* mod.ccontrol/DEAUTHCommand.cc: stop auto-authentication after netsplit if deauth'd

2005-06-19	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccUser.h: added LastAuthTS + LastAuthNumeric to users class

		* mod.ccontrol/LOGINCommand.cc: after successful login, record TS+Numeric for user.

		* mod.ccontrol/ccontrol.cc: check ts+numeric against opers table to auto-logon after netsplit.

2005-06-19	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol.h: added new global variable (CClonesTime) for below.
			- changed format of client ip maps from int to long (to hold timestamps)

		* mod.ccontrol/ccontrol.cc: added configurable time between cidr clones announcements.

		* mod.ccontrol/CONFIGCommand.cc: as above.

		* mod.ccontrol/WHOISCommand.cc: added 'account' status in 'whois' command

2005-06-19	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/ccontrol.cc: added IP after host in excessive clients msg
			also, changed affected users count to square brackets.

		* mod.ccontrol/ccontrol_generic.h: function prototypes (new file)

		* mod.ccontrol/ccontrol_generic.cc: new human readable generic functions.

		* mod.ccontrol/Makefile.am: Updated makefile for new files

		* mod.ccontrol/Makefile.in: Updated makefile for new files

		* mod.ccontrol/CHECKNETCommand.cc: made output more human readable.

		* mod.ccontrol/CHANINFOCommand.cc: made output more human readable.

		* mod.ccontrol/MAXUSERSCommand.cc: made output more human readable.

2005-06-18	Dan-m00 <daniel@undernet.org>
		* mod.ccontrol/FORCEGLINECommand.cc: CIDR reply info added for forceglines

		* mod.ccontrol/GLINECommand.cc: CIDR reply info added for glines

		* mod.ccontrol/SGLINECommand.cc: CIDR reply info added for sglines

2005-06-18	Dan-m00 <daniel@undernet.org>
		* src/Channel.cc: fixed problem that stopped compilation on FreeBSD/gcc 2.95

		* src/server.cc: fixed problem that stopped compilation on FreeBSD/gcc 2.95

		* include/Channel.h: gnuworld_config.h was not included, so topic_track did not work.

		* mod.ccontrol/REOPCommand.cc: fixed a few things here.
			- check that the user to be reop'd is actually in the channel.
			- dont join channel, op, part channel - get server to do it in 1 mode.

		* mod.ccontrol/ccontrol.h: added new variables for CIDR clone detection

		* mod.ccontrol/ccontrol.cc: added CIDR support.  also fixed gline bug
			- glines cannot start with a "."
			- glines cannot contain consecutive "."'s

		* libgnuworld/match.cc: added CIDR support to match() function.

		* mod.ccontrol/CONFIGCommand.cc: added CIDR options (see seperate commit)

		* mod.ccontrol/Constants.h: defined new return codes for CIDR matches

