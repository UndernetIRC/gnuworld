# $Id: Makefile.in,v 1.3 2000/07/07 14:20:34 dan_karrels Exp $
# all		-- gnuworld
# clean		-- cleanup objects and executable
# distclean	-- everything =P

# Standard defines
CXX = @CXX@
DEFS = @DEFS@
LIBS = @LIBS@

# Set this to -g if you want to be able to debug the client, otherwise
# use -O to have the compiler do some optimization instead.
CXXFLAGS = @CXXFLAGS@

SHLIB_CXX = @SHLIB_CXX@
SHLIB_LD = @SHLIB_LD@

MOD_CXX = @MOD_CXX@
MOD_LD = @MOD_LD@
MOD_DIRS = @MOD_DIRS@

BIN_PATH = @BIN_PATH@
SRC_PATH = @SRC_PATH@

RM = @RM@
CP = @CP@
MV = @MV@
LN = @LN@

############ You shouldn't change anything below this line ###################

VERSION = @VERSION@

SHELL = /bin/sh
MAKE2 = $(MAKE) $(MFLAGS)
MFLAGS ='CXX=$(CXX)'					\
	'ANSIFLAGS=$(ANSIFLAGS)'			\
	'CXXFLAGS=$(CXXFLAGS)'				\
	'DEFS=$(DEFS)'					\
	'LDFLAGS=$(LDFLAGS)'				\
	'RM=$(RM)'

all: libgnuworld gnuworld modules
everything: all

libgnuworld: lib/Makefile
	@cd lib; $(MAKE2) all

gnuworld: src/Makefile Makefile libgnuworld
	@cd src; $(MAKE2) all

modules:
	@echo "Building modules..."
	@cd src; $(MAKE2) modules
	@for i in $(MOD_DIRS); do \
		whichMod=`echo $$i | cut -d"." -f1`; \
		whichMod="$$whichMod.so"; \
		if [ -f $(BIN_PATH)/$$whichMod ]; then \
			$(RM) $(BIN_PATH)/$$whichMod; \
		fi; \
		if [ -f $(SRC_PATH)/$$i/$$whichMod ]; then \
			$(LN) -s $(SRC_PATH)/$$i/$$whichMod $(BIN_PATH)/$$whichMod ; \
		fi; \
	done;

clean:
	@-if [ -f lib/Makefile ]; then cd lib; $(MAKE2) clean; fi
	@-if [ -f src/Makefile ]; then cd src; $(MAKE2) clean; fi

distclean cleandir realclean:
	$(RM) config.status config.cache
	$(RM) config.log include/defs.h
	@cd lib; $(MAKE2) distclean
	@cd src; $(MAKE2) distclean
	$(RM) src/Makefile lib/Makefile
	$(RM) Makefile

depend:
	@echo
	@echo "Building dependencies, this may take a moment..."
	@echo
	@cd lib; make depend
	@cd src; make depend
	@echo
	@echo "Finished building dependencies"
	@echo
